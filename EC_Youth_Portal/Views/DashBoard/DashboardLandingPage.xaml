<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:EC_Youth_Portal.ViewModel"
             x:Class="EC_Youth_Portal.Views.DashBoard.DashboardLandingPage"
             x:DataType="viewmodels:DashboardLandingPageViewModel"
             BackgroundColor="#F5F5F5"
             NavigationPage.HasNavigationBar="False"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*">

        <!-- FIXED HEADER WITH NOTIFICATIONS & OPTIONS -->
        <Frame Grid.Row="0"
               BackgroundColor="#1E3A5F"
               CornerRadius="0"
               Padding="0"
               HasShadow="True">
            <Grid ColumnDefinitions="*,50,50"
                  Padding="20,10"
                  HeightRequest="65">

                <!-- Title Section -->
                <VerticalStackLayout Grid.Column="0" 
                                    Spacing="3" 
                                    VerticalOptions="Center">
                    <Label Text="Dashboard"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="White"/>
                    <Label Text="Discover opportunities that match your profile"
                           FontSize="12"
                           TextColor="#94A3B8"/>
                </VerticalStackLayout>

                <!-- Notifications Icon -->
                <Frame Grid.Column="1"
                       BackgroundColor="Transparent"
                       Padding="0"
                       WidthRequest="40"
                       HeightRequest="40"
                       VerticalOptions="Center"
                       HasShadow="False">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding NotificationsTappedCommand}"/>
                    </Frame.GestureRecognizers>
                    <Grid>
                        <Label Text="ðŸ””"
                               FontSize="22"
                               TextColor="White"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                        <!-- Notification Badge -->
                        <Border BackgroundColor="#FF4444"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 9"
                                Padding="0"
                                WidthRequest="18"
                                HeightRequest="18"
                                HorizontalOptions="End"
                                VerticalOptions="Start"
                                Margin="0,-2,-2,0"
                                IsVisible="{Binding HasNotifications}">
                            <Label Text="{Binding NotificationCount}"
                                   FontSize="10"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                    </Grid>
                </Frame>

                <!-- Options Menu -->
                <Frame Grid.Column="2"
                       BackgroundColor="Transparent"
                       Padding="0"
                       WidthRequest="40"
                       HeightRequest="40"
                       VerticalOptions="Center"
                       HasShadow="False">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding OptionsTappedCommand}"/>
                    </Frame.GestureRecognizers>
                    <Label Text="â‹®"
                           FontSize="26"
                           TextColor="White"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Rotation="90"/>
                </Frame>
            </Grid>
        </Frame>

        <!-- SCROLLABLE CONTENT -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="0">

                <!-- Decorative Background Elements -->
                <Grid HeightRequest="0">
                    <!-- Top Center Circle -->
                    <Ellipse WidthRequest="120"
                             HeightRequest="120"
                             Fill="#FFA500"
                             Opacity="0.06"
                             HorizontalOptions="Center"
                             VerticalOptions="Start"
                             Margin="0,-60,0,0"/>

                    <!-- Middle Left Circle -->
                    <Ellipse WidthRequest="80"
                             HeightRequest="80"
                             Fill="#1E3A5F"
                             Opacity="0.05"
                             HorizontalOptions="Start"
                             VerticalOptions="Start"
                             Margin="-40,150,0,0"/>

                    <!-- Bottom Right Circle -->
                    <Ellipse WidthRequest="100"
                             HeightRequest="100"
                             Fill="#FFA500"
                             Opacity="0.04"
                             HorizontalOptions="End"
                             VerticalOptions="End"
                             Margin="0,0,-50,-50"/>
                </Grid>

                <VerticalStackLayout Padding="20,15,20,20" Spacing="18">

                    <!-- Welcome Section with Page Description -->
                    <Border BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16"
                            Padding="18">
                        <Border.Shadow>
                            <Shadow Brush="Black"
                                    Opacity="0.06"
                                    Radius="10"
                                    Offset="0,2"/>
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="12">
                            <!-- Welcome Message -->
                            <Label Text="{Binding WelcomeMessage}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#1E3A5F"/>

                            <!-- Page Description -->
                            <Label Text="{Binding OpportunityCount, StringFormat='{0} AI-matched opportunities'}"
                                   FontSize="13"
                                   TextColor="#64748B"
                                   LineBreakMode="WordWrap"/>

                            <!-- Compact Stats Row -->
                            <Grid ColumnDefinitions="*,*,*"
                                  ColumnSpacing="8"
                                  Margin="0,8,0,0">

                                <!-- Applications -->
                                <Border Grid.Column="0"
                                        BackgroundColor="#F8F9FA"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 12"
                                        Padding="12,10">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ViewApplicationsCommand}"/>
                                    </Border.GestureRecognizers>
                                    <VerticalStackLayout Spacing="3">
                                        <Label Text="{Binding ApplicationCount}"
                                               FontSize="20"
                                               FontAttributes="Bold"
                                               TextColor="#1E3A5F"
                                               HorizontalOptions="Center"/>
                                        <Label Text="Applied"
                                               FontSize="10"
                                               TextColor="#64748B"
                                               HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Border>

                                <!-- Profile Completion -->
                                <Border Grid.Column="1"
                                        BackgroundColor="#F8F9FA"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 12"
                                        Padding="12,10">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding UpdateProfileCommand}"/>
                                    </Border.GestureRecognizers>
                                    <VerticalStackLayout Spacing="3">
                                        <Label Text="{Binding ProfileCompletionPercentage}"
                                               FontSize="20"
                                               FontAttributes="Bold"
                                               TextColor="#4CAF50"
                                               HorizontalOptions="Center"/>
                                        <Label Text="Profile"
                                               FontSize="10"
                                               TextColor="#64748B"
                                               HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Border>

                                <!-- Messages -->
                                <Border Grid.Column="2"
                                        BackgroundColor="#F8F9FA"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 12"
                                        Padding="12,10">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ViewMessagesCommand}"/>
                                    </Border.GestureRecognizers>
                                    <VerticalStackLayout Spacing="3">
                                        <Label Text="{Binding MessageCount}"
                                               FontSize="20"
                                               FontAttributes="Bold"
                                               TextColor="#FFA500"
                                               HorizontalOptions="Center"/>
                                        <Label Text="Messages"
                                               FontSize="10"
                                               TextColor="#64748B"
                                               HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Border>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Search & Filter Section -->
                    <VerticalStackLayout Spacing="12">

                        <!-- Search Bar -->
                        <Border BackgroundColor="White"
                                StrokeThickness="1"
                                Stroke="#E5E5E5"
                                StrokeShape="RoundRectangle 12"
                                Padding="15,12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SearchTappedCommand}"/>
                            </Border.GestureRecognizers>
                            <Grid ColumnDefinitions="Auto,*">
                                <Label Grid.Column="0"
                                       Text="ðŸ”"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       Margin="0,0,12,0"/>
                                <Label Grid.Column="1"
                                       Text="Search opportunities..."
                                       FontSize="14"
                                       TextColor="#94A3B8"
                                       VerticalOptions="Center"/>
                            </Grid>
                        </Border>

                        <!-- Filter Pills -->
                        <ScrollView Orientation="Horizontal"
                                    HorizontalScrollBarVisibility="Never">
                            <HorizontalStackLayout Spacing="10">
                                <Border BackgroundColor="#1E3A5F"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FilterCommand}" CommandParameter="All"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="All"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="White"/>
                                </Border>

                                <Border BackgroundColor="Transparent"
                                        Stroke="#E5E5E5"
                                        StrokeThickness="1"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FilterCommand}" CommandParameter="Jobs"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ’¼ Jobs"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="#1E3A5F"/>
                                </Border>

                                <Border BackgroundColor="Transparent"
                                        Stroke="#E5E5E5"
                                        StrokeThickness="1"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FilterCommand}" CommandParameter="Bursaries"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸŽ“ Bursaries"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="#1E3A5F"/>
                                </Border>

                                <Border BackgroundColor="Transparent"
                                        Stroke="#E5E5E5"
                                        StrokeThickness="1"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FilterCommand}" CommandParameter="Learnerships"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ§© Learnerships"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="#1E3A5F"/>
                                </Border>

                                <Border BackgroundColor="Transparent"
                                        Stroke="#E5E5E5"
                                        StrokeThickness="1"
                                        StrokeShape="RoundRectangle 20"
                                        Padding="16,8">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding FilterCommand}" CommandParameter="Internships"/>
                                    </Border.GestureRecognizers>
                                    <Label Text="ðŸ¢ Internships"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="#1E3A5F"/>
                                </Border>
                            </HorizontalStackLayout>
                        </ScrollView>
                    </VerticalStackLayout>

                    <!-- Opportunities Section Header -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0"
                               Text="AI-Matched For You"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#1E3A5F"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1"
                               Text="View All â€º"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="#FFA500"
                               VerticalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ViewAllOpportunitiesCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </Grid>

                    <!-- CLICKABLE OPPORTUNITY CARDS -->
                    <CollectionView ItemsSource="{Binding Opportunities}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodels:OpportunityCard">
                                <Border BackgroundColor="White"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 16"
                                        Padding="16"
                                        Margin="0,0,0,12">
                                    <Border.Shadow>
                                        <Shadow Brush="Black"
                                                Opacity="0.05"
                                                Radius="8"
                                                Offset="0,2"/>
                                    </Border.Shadow>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:DashboardLandingPageViewModel}}, Path=ViewOpportunityDetailCommand}" 
                                                            CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>

                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto"
                                          RowSpacing="12">

                                        <!-- Header Row: Type Badge & Match Score -->
                                        <Grid Grid.Row="0"
                                              ColumnDefinitions="Auto,*,Auto">

                                            <!-- Type Icon -->
                                            <Border Grid.Column="0"
                                                    BackgroundColor="#F8F9FA"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 10"
                                                    Padding="10"
                                                    WidthRequest="44"
                                                    HeightRequest="44">
                                                <Label Text="{Binding TypeIcon}"
                                                       FontSize="22"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"/>
                                            </Border>

                                            <!-- Match Score Badge -->
                                            <Border Grid.Column="2"
                                                    BackgroundColor="#E8F5E9"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 12"
                                                    Padding="10,6">
                                                <Label Text="{Binding MatchScore, StringFormat='{0}% Match'}"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="#4CAF50"/>
                                            </Border>
                                        </Grid>

                                        <!-- Title & Company -->
                                        <VerticalStackLayout Grid.Row="1"
                                                           Spacing="6">
                                            <Label Text="{Binding Title}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="#1E3A5F"
                                                   LineBreakMode="WordWrap"
                                                   MaxLines="2"/>
                                            <HorizontalStackLayout Spacing="6">
                                                <Label Text="ðŸ¢"
                                                       FontSize="12"
                                                       VerticalOptions="Center"/>
                                                <Label Text="{Binding Company}"
                                                       FontSize="13"
                                                       TextColor="#64748B"
                                                       VerticalOptions="Center"/>
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>

                                        <!-- Details Grid -->
                                        <Grid Grid.Row="2"
                                              ColumnDefinitions="*,*,*"
                                              ColumnSpacing="12">

                                            <!-- Location -->
                                            <VerticalStackLayout Grid.Column="0"
                                                               Spacing="3">
                                                <Label Text="ðŸ“ Location"
                                                       FontSize="10"
                                                       TextColor="#94A3B8"/>
                                                <Label Text="{Binding Location}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="#1E3A5F"
                                                       LineBreakMode="TailTruncation"/>
                                            </VerticalStackLayout>

                                            <!-- Detail 1 -->
                                            <VerticalStackLayout Grid.Column="1"
                                                               Spacing="3">
                                                <Label Text="{Binding Detail1Label}"
                                                       FontSize="10"
                                                       TextColor="#94A3B8"/>
                                                <Label Text="{Binding Detail1Value}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="#1E3A5F"
                                                       LineBreakMode="TailTruncation"/>
                                            </VerticalStackLayout>

                                            <!-- Detail 2 -->
                                            <VerticalStackLayout Grid.Column="2"
                                                               Spacing="3">
                                                <Label Text="{Binding Detail2Label}"
                                                       FontSize="10"
                                                       TextColor="#94A3B8"/>
                                                <Label Text="{Binding Detail2Value}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       TextColor="#1E3A5F"
                                                       LineBreakMode="TailTruncation"/>
                                            </VerticalStackLayout>
                                        </Grid>

                                        <!-- View Details Button -->
                                        <Border Grid.Row="3"
                                                BackgroundColor="#FFA500"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 10"
                                                Padding="0,12">
                                            <Border.Shadow>
                                                <Shadow Brush="#FFA500"
                                                        Opacity="0.25"
                                                        Radius="8"
                                                        Offset="0,2"/>
                                            </Border.Shadow>
                                            <Label Text="View Details â†’"
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"/>
                                        </Border>

                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Bottom Spacing -->
                    <BoxView HeightRequest="20"
                             Color="Transparent"/>

                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

    </Grid>

</ContentPage>
